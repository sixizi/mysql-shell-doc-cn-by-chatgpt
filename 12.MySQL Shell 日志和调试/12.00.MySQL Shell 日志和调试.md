# 第 12 章 MySQL Shell 日志和调试

目录

- [12.1 应用日志](./12.01.应用日志.md)
- [12.2 详细输出](./12.02.详细输出.md)
- [12.3 用户 SQL 语句的系统日志记录](./12.03.用户 SQL 语句的系统日志记录.md)
- [12.4 MySQL Shell SQL 日志记录](./12.04.MySQL Shell SQL 日志记录.md)
- [12.5 记录 AdminAPI 操作](./12.05.记录 AdminAPI 操作.md)

您可以使用 MySQL Shell 的日志记录功能来验证 MySQL Shell 运行时的状态并排查任何问题。

默认情况下，MySQL Shell 将日志级别 5（错误、警告和信息性消息）的日志信息发送到应用日志文件。您还可以配置 MySQL Shell 将信息发送到可选的可视位置，并且（从 MySQL 8.0.17 开始）以详细输出的形式发送到控制台。

您可以控制发送到每个目的地的详细级别。对于应用日志和额外的可视位置，您可以指定任何可用级别作为最大详细级别。对于详细输出，您可以指定映射到最大详细级别的设置。以下是可用的详细级别：

表 12.1 MySQL Shell 中的日志级别

| 日志级别 - 数值 | 日志级别 - 文本 | 含义           | 详细设置 |
| --------------- | --------------- | -------------- | -------- |
| 1               | 无              | 不进行日志记录 | 0        |
| 2               | 内部            | 内部错误       | 1        |
| 3               | 错误            | 错误           | 1        |
| 4               | 警告            | 警告           | 1        |
| 5               | 信息            | 信息性         | 1        |
| 6               | 调试            | 调试           | 2        |
| 7               | 调试2           | 调试2          | 3        |
| 8               | 调试3           | 调试3          | 4        |

从 MySQL Shell 8.0.24 开始，您可以选择将在 MySQL Shell 的 SQL 模式下交互式发出的 SQL 语句发送到操作系统的系统日志设施（Unix 上的 syslog 或 Windows 事件日志）。从 MySQL Shell 代码历史中排除的 SQL 语句不会发送到系统日志设施。

默认情况下，MySQL Shell 不会记录或输出 MySQL Shell 自身在执行 AdminAPI 操作过程中执行的 SQL 语句。从 MySQL Shell 8.0.18 开始，如果您希望在 SQL 执行方面观察这些操作的进度，除了在操作过程中返回的消息外，您可以激活这些语句的日志记录。这些语句作为信息性消息写入 MySQL Shell 应用日志文件，前提是日志级别设置为 5 或以上。它们也在详细设置为 1 或以上时发送到控制台作为详细输出。

默认情况下，MySQL Shell 将一个程序的所有日志发送到同一个应用日志文件，并将一个程序的所有输出发送到相同的目的地。从 MySQL Shell 8.0.26 开始，函数 `shell.create_context` 可以在 MySQL Shell 的 Python 模式下使用，以支持 Python 程序的多线程。该函数在新的 Python 线程内使用，以创建一个作用域，该作用域隔离日志、中断和委托。上下文包装器处理并隔离输出到 stdout 和 stderr 的输出和诊断输出，以及用户输入，密码有单独的处理。您还可以创建特定于线程的个别应用日志文件。

有关配置应用日志和可选的额外目的地（在基于 Unix 的系统上是 stderr 或在 Windows 系统上是 `OutputDebugString()` 函数）的说明，请参见第 12.1 节，“应用日志”。

有关将日志信息发送到控制台作为详细输出的说明，请参见第 12.2 节，“详细输出”。

有关将交互式 SQL 语句发送到系统日志设施的说明，请参见第 12.3 节，“用户 SQL 语句的系统日志记录”。

有关激活 AdminAPI 操作执行的 SQL 语句的日志记录的说明，请参见第 12.5 节，“记录 AdminAPI 操作”。