### 4.3.7.1 MySQL Shell 8.0.20 及以后版本的压缩控制

从 MySQL Shell 8.0.20 版本开始，对于 X 协议连接和经典 MySQL 协议连接，每当您创建会话对象以管理到 MySQL 服务器实例的连接时，都可以指定该连接是否需要压缩、偏好压缩或禁用压缩。

- `required`（必需）从服务器请求压缩连接，如果服务器不支持压缩或无法与 MySQL Shell 协商压缩协议，则连接失败。
- `preferred`（偏好）从服务器请求压缩连接，如果服务器不支持压缩或无法与 MySQL Shell 协商压缩协议，则回退到未压缩连接。这是 X 协议连接的默认设置。
- `disabled`（禁用）请求未压缩的连接，如果服务器只允许压缩连接，则连接失败。这是经典 MySQL 协议连接的默认设置。

从 MySQL Shell 8.0.20 版本开始，您还可以选择允许哪些压缩算法用于连接。默认情况下，MySQL Shell 为 X 协议连接向服务器提出 zlib、LZ4 和 zstd 算法，并为经典 MySQL 协议连接提出 zlib 和 zstd 算法（不支持 LZ4 算法）。您可以指定这些算法的任何组合。您指定压缩算法的顺序是 MySQL Shell 提议它们的偏好顺序，但服务器可能不会受到此偏好的影响，这取决于协议和服务器配置。

指定任何压缩算法或算法组合自动为连接请求压缩，因此您可以使用它而不是使用单独的参数来指定压缩是必需的、偏好的还是被禁用的。使用这种连接压缩控制方法，通过在压缩算法列表中添加 `uncompressed`（允许未压缩连接）选项来指示压缩是必需的还是偏好的。如果您包含了 `uncompressed`，则偏好压缩；如果您没有包含，压缩则是必需的。您也可以单独传入 `uncompressed` 来指定压缩被禁用。如果您在单独的参数中指定压缩是必需的、偏好的或被禁用的，这将优先于在压缩算法列表中使用 `uncompressed`。

您还可以为连接指定数字压缩级别，适用于 X 协议连接的任何压缩算法，或仅适用于经典 MySQL 协议连接的 zstd 算法。对于 X 协议连接，如果服务器对最终选择的算法不接受指定的压缩级别，服务器会根据 X 插件的连接压缩中列出的行为选择适当的设置。例如，如果 MySQL Shell 请求 zlib 算法的压缩级别为 7，而服务器的 `mysqlx_deflate_max_client_compression_level` 系统变量（限制 deflate 或 zlib 压缩的最大压缩级别）设置为默认值 5，则服务器使用最高允许的压缩级别 5。

如果 MySQL 服务器实例不支持协议的连接压缩（在 MySQL 8.0.19 之前的 X 协议连接就是这种情况），或者如果它支持连接压缩但不支持指定连接算法和压缩级别，MySQL Shell 将在不指定不支持的参数的情况下建立连接。

要从 MySQL Shell 8.0.20 请求连接压缩，请使用以下方法之一：
