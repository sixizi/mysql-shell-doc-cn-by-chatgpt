### 7.4.6 在InnoDB集群中使用MySQL克隆

- [7.4.6.1 使用MySQL克隆的集群工作](./07.04.06.01.使用MySQL克隆的集群工作.md)

在MySQL 8.0.17中，InnoDB集群集成了MySQL克隆插件，以提供加入实例的自动配置。检索集群数据以便实例能够与集群同步的过程称为分布式恢复。当实例需要恢复集群的事务时，我们区分提供数据的赠与者（即集群实例）和接收者（即从赠与者接收数据的实例）。在以前的版本中，Group Replication只提供异步复制来恢复加入实例同步到集群所需的事务，以便它能加入集群。对于一个处理了大量事务的集群，新实例恢复所有事务并能够加入集群可能需要很长时间。或者，例如作为常规维护的一部分，已清除GTID的集群可能缺少恢复新实例所需的某些事务。在这种情况下，唯一的替代方案是使用MySQL Enterprise Backup等工具手动配置实例，如使用MySQL Enterprise Backup与Group Replication一文中所示。

MySQL克隆提供了一种替代方式，用于实例恢复同步到集群所需的事务。MySQL克隆不是依赖于异步复制来恢复事务，而是在赠与者实例上拍摄数据快照，然后将快照传输给接收者。

警告
在克隆操作期间，接收者中的所有先前数据都将被销毁。然而，所有未存储在表中的MySQL设置都会被保留。

一旦克隆操作将快照传输给接收者，如果在传输快照期间集群处理了事务，则使用异步复制来恢复接收者与集群同步所需的任何数据。这可能比实例使用异步复制恢复所有事务更高效，并避免了由于GTID清除引起的任何问题，使您能够快速为InnoDB集群配置新实例。更多信息，请参见克隆插件和分布式恢复克隆。

与使用MySQL克隆相对，增量恢复是加入集群的实例仅使用异步复制从集群恢复实例的过程。当InnoDB集群配置为使用MySQL克隆时，加入集群的实例使用MySQL克隆或增量恢复恢复集群的事务。默认情况下，集群自动选择最合适的方法，但您也可以选择配置此行为，例如强制克隆，这将替换加入实例已处理的任何事务。当您在交互模式下使用MySQL Shell时，默认情况下，如果集群不确定它是否可以继续恢复，它会提供一个交互提示。本节描述了您提供的不同选项，以及影响您可以选择哪些选项的不同场景。

此外，对于处于RECOVERING状态的成员，`Cluster.status()`的输出包括恢复进度信息，使您可以轻松监控恢复操作，无论它们是使用MySQL克隆还是增量恢复。InnoDB集群在`Cluster.status()`的输出中提供了使用MySQL克隆的实例的额外信息。